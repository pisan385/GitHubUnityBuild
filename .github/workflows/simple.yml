# Based on https://game.ci/docs/github/getting-started
name: Actions ðŸ˜Ž

on: [push]

# Similar to https://github.com/game-ci/unity-builder/blob/main/.github/workflows/build-tests.yml
# This could be stored as secret key in repository as well
# See instructions at https://game.ci/docs/github/activation

env:
  UNITY_LICENSE: "<?xml version=\"1.0\" encoding=\"UTF-8\"?><root>\n     <License id=\"Terms\">\n         <MachineBindings>\n             <Binding Key=\"1\" Value=\"576562626572264761624c65526f7578\"/>\n             <Binding Key=\"2\" Value=\"576562626572264761624c65526f7578\"/>\n         </MachineBindings>\n         <MachineID Value=\"D7nTUnjNAmtsUMcnoyrqkgIbYdM=\"/>\n         <SerialHash Value=\"a50863db909cb6e06a7ffe2c2cb5409b9508c699\"/>\n         <Features>\n             <Feature Value=\"33\"/>\n             <Feature Value=\"1\"/>\n             <Feature Value=\"12\"/>\n             <Feature Value=\"2\"/>\n             <Feature Value=\"24\"/>\n             <Feature Value=\"3\"/>\n             <Feature Value=\"36\"/>\n             <Feature Value=\"17\"/>\n             <Feature Value=\"19\"/>\n             <Feature Value=\"62\"/>\n         </Features>\n         <DeveloperData Value=\"AQAAAEY0LTJYUUctRDdIVC1STlNSLUFUVkQtTVUySw==\"/>\n         <SerialMasked Value=\"F4-2XQG-D7HT-RNSR-ATVD-XXXX\"/>\n         <StartDate Value=\"2018-03-09T00:00:00\"/>\n         <UpdateDate Value=\"2021-04-11T20:16:43\"/>\n         <InitialActivationDate Value=\"2018-03-09T17:04:02\"/>\n         <LicenseVersion Value=\"6.x\"/>\n         <ClientProvidedVersion Value=\"2019.2.11f1\"/>\n         <AlwaysOnline Value=\"false\"/>\n         <Entitlements>\n             <Entitlement Ns=\"unity_editor\" Tag=\"UnityPersonal\" Type=\"EDITOR\" ValidTo=\"9999-12-31T00:00:00\"/>\n             <Entitlement Ns=\"unity_editor\" Tag=\"DarkSkin\" Type=\"EDITOR_FEATURE\" ValidTo=\"9999-12-31T00:00:00\"/>\n         </Entitlements>\n     </License>\n <Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments\"/><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><Reference URI=\"#Terms\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><DigestValue>pT2ETHHE0VIYu3bNYoFTUbSIOnY=</DigestValue></Reference></SignedInfo><SignatureValue>KbOzTS3Sgur4KX3LmCiSFyss8O0hgsmDjgoRUlcuIKtfh9aiBEiS9jilWNzS0+3BvUR0UHrJi5r8\n T3v2ybODTY9Ns4uxaXrDN1yl7pfpf7ISw1Ll+6PD1AymiGQFKIxKzBZ0AZQvzFW4QZSMs8GyIEcU\n SXieRIugtcg3Y4q/FW/w6UFJz+C7tJWbFSmhZNikJ3AG+3SzUjm4fyP7hOsm5YCkdh3DmUWc9XY9\n dNSU4nrAHWWAUvx8Gjo/bacpgnpBKOsfub3pGBa6x+Qy4caiMTygPCGZ6eHJKY1EDtf60eRZCEO1\n 7RtI1Fx30N6gB5QbaTzxcQfPPHy330RvhLETFw==</SignatureValue></Signature></root>"

jobs:
  build:
    name: Build my project
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        targetPlatform:
          # - StandaloneOSX # Build a macOS standalone (Intel 64-bit).
          # - StandaloneWindows # Build a Windows standalone.
          # - StandaloneWindows64 # Build a Windows 64-bit standalone.
          # - StandaloneLinux64 # Build a Linux 64-bit standalone.
          # - iOS # Build an iOS player.
          # - Android # Build an Android .apk standalone app.
          - WebGL # WebGL.
    steps:
      # Checkout
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          lfs: true
      # - name: Check compression
      #     - run: echo "webGLCompressionFormat must be 2 to disable compression"
      #     - run: grep webGLCompressionFormat ProjectSettings/ProjectSettings.asset

      # Cache
      - name: Work the Cache
        uses: actions/cache@v2
        with:
          path: src/Library
          key: Library-MyProjectName-${{ matrix.targetPlatform }}
          restore-keys: |
            Library-MyProjectName-
            Library-

      # Build
      - name: Game-CI Unity Builder
        uses: game-ci/unity-builder@v2
        env:
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
        with:
          projectPath: src
          targetPlatform: ${{ matrix.targetPlatform }}
      
      # Output
      - uses: actions/upload-artifact@v2
        with:
          name: Build-${{ matrix.targetPlatform }}
          path: build/${{ matrix.targetPlatform }}
